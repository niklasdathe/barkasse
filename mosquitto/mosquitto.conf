# ─── Barkasse Mosquitto Configuration ───
# Generated by setup-security.sh — do not edit manually.

# Disable anonymous access
allow_anonymous false
password_file /etc/mosquitto/barkasse_passwd

# ─── Listener 1: Plain MQTT on localhost only ───
# (for Node-RED and local services that communicate over loopback)
listener 1883 127.0.0.1
protocol mqtt

# ─── Listener 2: MQTT over TLS (all interfaces) ───
# (for ESP32 sensors and remote MQTT clients on the LAN)
listener 8883
protocol mqtt
cafile   /etc/mosquitto/certs/ca.crt
certfile /etc/mosquitto/certs/server.crt
keyfile  /etc/mosquitto/certs/server.key
tls_version tlsv1.2

# Persistence — note: 'persistence true' and 'persistence_location' are
# already set in /etc/mosquitto/mosquitto.conf, so we only add autosave here
# to avoid "Duplicate persistence_location" errors.
autosave_interval 60
